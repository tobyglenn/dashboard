# bjj-001: Fix Nested set() Bug in bjjStore.updateSession

**Status:** Review  
**Assignee:** Clarity  
**Epic:** NutriTrack BJJ Buddy

## Actual Bug (verified)

In `bjjStore.ts` line 168, `updateSession` calls `state.calculateStats()` inside a Zustand `set()` callback. `calculateStats` internally calls another `set()` — this is a **nested set() call** which causes stale state updates with Immer.

The comment on line 148 even says *"Recalculate stats inline to avoid nested set()"* but `updateSession` still does it wrong.

```ts
// ❌ BROKEN — updateSession (line 161-171)
set((state) => {
  state.sessions[sessionIndex] = { ...state.sessions[sessionIndex], ...partial }
  state.calculateStats()  // ← calls set() inside set() — BUG
})

// ✅ FIX — inline like addSession does it
set((state) => {
  state.sessions[sessionIndex] = { ...state.sessions[sessionIndex], ...partial }
  state.stats = computeStats(state.sessions)  // inline, no nested set()
})
```

## Steps

1. Open `nutrition-app/bjj-buddy/src/store/bjjStore.ts`
2. Find `updateSession` (around line 161)
3. Replace `state.calculateStats()` with `state.stats = computeStats(state.sessions)`
4. Verify `computeStats` is in scope (it's defined at line 100)
5. Confirm no TypeScript errors

## Success Criteria
- `updateSession` no longer calls `state.calculateStats()`
- Stats recalculation is inline using `computeStats(state.sessions)`
- No TypeScript errors
